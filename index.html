<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba de Web Speech API</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        textarea { width: 100%; height: 150px; margin-top: 10px; }
        button { padding: 10px; font-size: 16px; margin: 5px; }
    </style>
</head>
<body>

    <h1>üéôÔ∏è Prueba de Dictado (Web Speech API)</h1>
    <p>Presiona "Grabar" y habla. El texto aparecer√° abajo.</p>

    <button id="boton-grabar">Grabar</button>
    <button id="boton-parar">Parar</button>

    <textarea id="resultado" placeholder="Aqu√≠ aparecer√° tu transcripci√≥n..."></textarea>

    <script>
        // 1. Verificar si el navegador soporta la API
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) {
            alert("Tu navegador no soporta la Web Speech API. Intenta con Chrome o Edge.");
        }

        // 2. Crear una instancia de reconocimiento
        const recognition = new SpeechRecognition();
        const textareaResultado = document.getElementById('resultado');

        // 3. Configuraci√≥n
        recognition.lang = 'es-AR'; // Espa√±ol (Argentina)
        recognition.interimResults = false; // No queremos resultados provisionales
        recognition.continuous = true; // Sigue escuchando hasta que lo paremos

        // 4. Manejar el evento 'onresult' (cuando se detecta el habla)
        recognition.onresult = (event) => {
            let transcripcion = '';
            // Iteramos sobre los resultados (aunque con 'continuous' = false, usualmente solo hay 1)
            for (const result of event.results) {
                transcripcion += result[0].transcript;
            }
            
            // A√±adimos la transcripci√≥n al textarea
            // Usamos .value en lugar de .innerText para textareas
            textareaResultado.value += transcripcion + ' '; 
        };

        // 5. Manejar errores
        recognition.onerror = (event) => {
            console.error('Error en el reconocimiento de voz:', event.error);
            alert('Error: ' + event.error);
        };

        // 6. Asignar funciones a los botones
        document.getElementById('boton-grabar').addEventListener('click', () => {
            recognition.start();
            console.log('Grabaci√≥n iniciada...');
        });

        document.getElementById('boton-parar').addEventListener('click', () => {
            recognition.stop();
            console.log('Grabaci√≥n detenida.');
        });

        // 7. (Opcional) Reiniciar cuando se detiene para que siempre est√© escuchando
        recognition.onend = () => {
            console.log('El reconocimiento se detuvo. (Si no fue manual, se reiniciar√° si continuous=true)');
        };

    </script>

</body>
</html>
